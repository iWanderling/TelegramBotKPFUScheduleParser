""" –ü–∞—Ä—Å–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞ """
from constant import *
import openpyxl


# –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Ü–≤–µ—Ç–∞, –∑–∞–ø–æ–ª–Ω—è—é—â–µ–≥–æ —è—á–µ–π–∫—É —Ç–∞–±–ª–∏—Ü—ã:
def fill_color(code: str) -> openpyxl.styles.PatternFill:
    return openpyxl.styles.PatternFill(start_color=code, fill_type='solid')


# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –ª–∞–∫–æ–Ω–∏—á–Ω—ã–π –≤–∏–¥:
def formating_string(s: str) -> str:
    text = list()
    links = list()

    for rlt in removedLinkText:
        s = s.replace(rlt, " ")
        s = s.replace(rlt.lower(), " ")

    s = s.replace("..", ".")
    words = s.split()

    for w in words:
        if "http" in w:
            links.append(w)
        else:
            text.append(w)

    text = " ".join(text)
    links = "\n".join(links)

    return f"‚èπ ‚èπ ‚èπ\n\nüíª –û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä—ã:\n\n{text}\n\nüìö –°—Å—ã–ª–∫–∏ –Ω–∞ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é / –º–∞—Ç–µ—Ä–∏–∞–ª—ã:\n\n{links}"


# –§—É–Ω–∫—Ü–∏—è-–ø–∞—Ä—Å–µ—Ä.
# –°—Ç—Ä–æ–∫–∞ t_path - –ø—É—Ç—å –∫ —Ç–∞–±–ª–∏—Ü–µ;
# –°—Ç—Ä–æ–∫–∞ dest - –ø—É—Ç—å, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É.
def parsing(t_path: str, dest: str) -> None:

    # –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É:
    wb_out = openpyxl.Workbook()
    ws_out = wb_out.active

    # –û—Ç–∫—Ä—ã–≤–∞–µ–º —Ç–∞–±–ª–∏—Ü—É, –∏–∑ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é:
    wb_table = openpyxl.open(t_path)
    ws_table = wb_table.active

    # –í–≤–æ–¥–∏–º —è—á–µ–π–∫–∏ <–î–µ–Ω—å –ù–µ–¥–µ–ª–∏>, <–ù–∞—á–∞–ª–æ>, <–û–∫–æ–Ω—á–∞–Ω–∏–µ>.
    # –ö—Ä–∞—Å–∏–º –∏—Ö –≤ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π —Ü–≤–µ—Ç, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —à–∏—Ä–∏–Ω—É –¥–ª—è –ø–µ—Ä–≤—ã—Ö —Ç—Ä—ë—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ —Ç–∞–±–ª–∏—Ü—ã:
    for j in range(1, 4):
        ws_out.cell(row=1, column=j).value = data_columns[j - 1][0]
        ws_out.cell(row=1, column=j).fill = fill_color(data_columns[j - 1][1])
        ws_out.column_dimensions[columns[j - 1]].width = cwidth

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –¥–ª—è —è—á–µ–µ–∫ - –Ω–∞–∑–≤–∞–Ω–∏–π –≥—Ä—É–ø–ø.
    # –í–≤–æ–¥–∏–º –Ω–∞–∑–≤–∞–Ω–∏—è –≥—Ä—É–ø–ø –≤ —è—á–µ–π–∫–∏, –∫—Ä–∞—Å–∏–º –∏—Ö, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —à–∏—Ä–∏–Ω—É –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å—Ç–æ–ª–±—Ü–æ–≤ —Ç–∞–±–ª–∏—Ü—ã:
    group_fill_color = fill_color('DCDCDC')
    for j in range(4, len(groups) + 4):
        ws_out.column_dimensions[columns[j - 1]].width = cwidth
        ws_out.cell(row=1, column=j).value = groups[j - 4]
        ws_out.cell(row=1, column=j).fill = group_fill_color

    # –ü–æ–ª—É—á–∞–µ–º —à–∏—Ä–∏–Ω—É —Ç–∞–±–ª–∏—Ü—ã, –∏–∑ –∫–æ—Ç–æ—Ä–æ–π –±–µ—Ä—ë—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
    table_width = ws_table.max_column

    # –ó–Ω–∞—á–µ–Ω–∏–µ –¥–Ω—è –Ω–µ–¥–µ–ª–∏ (1-6 - –æ—Ç –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞ –¥–æ —Å—É–±–±–æ—Ç—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ):
    current_day = 0

    # –¶–≤–µ—Ç –¥–ª—è —è—á–µ–µ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–∞—Ä–µ:
    not_empty_fill_color = fill_color('FFEBCD')

    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –≤ —ç—Ç–æ–º —Ü–∏–∫–ª–µ, —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –µ—ë –∏ –¥–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É.
    # –ê–ª–≥–æ—Ä–∏—Ç–º - –ø—Ä–æ—Ö–æ–¥–∏–º –ø–æ –∫–∞–∂–¥–æ–π —è—á–µ–π–∫–µ —Å –∏–Ω–¥–µ–∫—Å–æ–º i1, –≥–¥–µ i - –Ω–æ–º–µ—Ä —Ä—è–¥–∞, –Ω–∞—á–∏–Ω–∞—è —Å 1.
    # –ï—Å–ª–∏ –≤ –¥–∞–Ω–Ω–æ–π —è—á–µ–π–∫–µ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ current_day.
    # –ò–Ω–∞—á–µ –µ—Å–ª–∏ –≤ –¥–∞–Ω–Ω–æ–π —è—á–µ–π–∫–µ (i1) —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞ –ø–∞—Ä—ã -
    # —Ç–æ –ø—Ä–æ–±–µ–≥–∞–µ–º—Å—è –ø–æ –≤—Å–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º —Ä—è–¥–∞ i –∏ —Å—Ç–æ–ª–±—Ü–∞ j –∏ –≤–Ω–æ—Å–∏–º –∏—Ö –≤ —Ç–∞–±–ª–∏—Ü—É, –ø–µ—Ä–µ–¥ —ç—Ç–∏–º –≤–Ω–µ—Å—è –≤ –ø–µ—Ä–≤—ã–µ
    # —Ç—Ä–∏ —Ä—è–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –¥–Ω–µ –Ω–µ–¥–µ–ª–∏ (current_day), –Ω–∞—á–∞–ª–µ (xx:xx) –∏ –∫–æ–Ω—Ü–µ (xx:xx) –ø–∞—Ä—ã:
    i_out = 2
    for i in range(2, ws_table.max_row):

        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã—Å–æ—Ç—É –∫–∞–∂–¥–æ–≥–æ —Ä—è–¥–∞ - 20px:
        ws_out.row_dimensions[i].height = cheight

        # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–∑ —è—á–µ–π–∫–∏ Cell[i][1]
        cell_i1 = ws_table.cell(row=i, column=1).value

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ —è—á–µ–π–∫–µ:
        if type(cell_i1) == str:

            # –ï—Å–ª–∏ –ø–æ–ª—É—á–µ–Ω –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫
            if ':' not in cell_i1:
                current_day += 1

            # –ò–Ω–∞—á–µ –µ—Å–ª–∏ –ø–æ–ª—É—á–µ–Ω–æ –≤—Ä–µ–º—è - –ø—Ä–æ–±–µ–≥–∞–µ–º—Å—è –ø–æ —Ä—è–¥—É i –∏ –≤—Å–µ–º —Å—Ç–æ–ª–±—Ü–∞–º —ç—Ç–æ–≥–æ —Ä—è–¥–∞,
            # –≤–Ω–æ—Å—è –∫–∞–∂–¥—ã–π —Å—Ç–æ–ª–±–µ—Ü —Ä—è–¥–∞ i –≤ –Ω–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É:
            elif ':' in cell_i1:

                # –†–∞–∑–¥–µ–ª—è–µ–º –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞ –ø–∞—Ä—ã:
                begin, end = cell_i1.split("-")

                # –ù–∞ –ø–µ—Ä–≤—ã–µ —Ç—Ä–∏ —Å—Ç–æ–ª–±—Ü–∞ —Ä—è–¥–∞ i —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
                # –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–Ω–µ –Ω–µ–¥–µ–ª–∏, –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞ –∏ –≤—Ä–µ–º–µ–Ω–∏ –∫–æ–Ω—Ü–∞ –ø–∞—Ä—ã:
                ws_out.cell(row=i_out, column=1).value = current_day
                ws_out.cell(row=i_out, column=2).value = begin
                ws_out.cell(row=i_out, column=3).value = end

                # –í–≤–æ–¥–∏–º –≤ –∫–∞–∂–¥—ã–π —Å—Ç–æ–ª–±–µ—Ü —Ä—è–¥–∞ i –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–∞—Ä–µ.
                # (–ü—Ä–∏–º.) –°–æ–∑–¥–∞–Ω —Ñ–ª–∞–≥, –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–æ–≤–µ—Ä–∫–∏
                # –Ω–µ–ø—É—Å—Ç–æ—Ç—ã —Ö–æ—Ç—è-–±—ã –æ–¥–Ω–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–∞—Ä–µ –Ω–∞ —Ä—è–¥—É i.
                # –í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –¥–∞–Ω–Ω—ã–π –ø—É—Å—Ç–æ–π —Ä—è–¥ –Ω–µ –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω:
                flag = True
                for j in range(2, table_width + 1):
                    ij_tableValue = ws_table.cell(row=i, column=j).value

                    # –ï—Å–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞—Ä–µ —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è, —Ç–æ —É–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏ –∫—Ä–∞—Å–∏–º —è—á–µ–π–∫—É:
                    if ij_tableValue is not None and (ij_tableValue not in ("", " ", "\n", "¬†")):
                        ij_tableValue = formating_string(" ".join(ij_tableValue.split()))

                        flag = False
                        ws_out.cell(row=i_out, column=j + 2).fill = not_empty_fill_color

                    # –ó–∞–ø–æ–ª–Ω—è–µ–º —è—á–µ–π–∫—É:
                    ws_out.cell(row=i_out, column=j + 2).value = ij_tableValue

                if not flag:
                    i_out += 1

    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã:
    wb_out.save(dest)
